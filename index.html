<html>
<head>
    <title>Leaflet</title>
<link rel="stylesheet" href="leaflet.css" />
<script src="leaflet.js"></script>    
<script type='text/javascript' src="Marker.Text.js"></script>
    <style type="text/css">
        .label {
            margin-top: 0px !important;
            font-size: 10px !important;

        }
    </style>
<script src="hull.js"></script>    
</head>
<body>
    <div style="width:100%; height:100%" id="map"></div>

<script type='text/javascript'>
Array.prototype.getUnique = function(){
    var a = [this[0]];
    for(var i = 1, l = this.length; i < l; ++i){
        var notexists = false;
        for(var j = 0, ll = a.length; j < ll; j++){
            if(this[i][0] != a[j][0] || this[i][1] != a[j][1]){
                notexists = true;
                break;
            }
        }
        if(notexists){
            a.push(this[i]);
        }
        
    }
    return a;
}

var map = L.map('map');
map.addLayer(new L.TileLayer('http://{s}.tiles.mapbox.com/v3/nredko.ifiekjj3/{z}/{x}/{y}.png'));

var DEBUG = false;
var DEBUG1 = false;
function JSONP(obj){
    var points = obj.points;//.getUnique();
    //if(DEBUG) 
    console.log(points.length + " points.");
    var pts = [];
    for(var i = 0; i < points.length; i++){
        var p = new L.latLng(points[i]);
        p.name = ''+i;
        var coord = L.CRS.EPSG3395.latLngToPoint(p, 18);
        p.x = coord.x;
        p.y = coord.y;
        pts.push(p);
    }

    for(i = 0; i < pts.length; i ++){
        var rr = L.circleMarker(pts[i], {title: pts[i].name, color:"#000", radius:2, fillOpacity:1})
                .addTo(map);
        //var myIcon = L.divIcon({className:'label', html:''+i});
        //L.marker(pts[i], {icon: myIcon}).addTo(map);

    }
    map.fitBounds(pts);
//    console.log("56 <-> 2 = "+pts[56].distance2(pts[2]) + "("+pts[56].distanceTo(pts[2])+"m)");
    var hull = pts.concaveHull(85000)
    var hullP = L.polygon(hull, {color: '#00F', fillColor: '#00F', fillOpacity: 0.5, weight: 1});
    console.log(hull.length + " points in hull.");
    hullP.addTo(map);

//    test = [pts[22], pts[2], pts[27]];
//    console.log("22 -> 2 -> 27 => 2" + test.intersect(pts[2]));
}

</script>

<!--
<script type='text/javascript' src="http://127.0.0.1:5000/distance?jsonp=JSONP&loc=54.8625731,83.0933268&time=100"></script>
-->
<script type='text/javascript' src="data100.js"></script>

</body>


</html>

